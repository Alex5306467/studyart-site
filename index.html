<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StudyArt — вход и регистрация</title>
  <meta name="description" content="Вход в StudyArt: Google / Apple или регистрация по email.">
  <style>
    :root{
      --bg:#f6fbf8; --mint:#d8f3e3; --mint-strong:#a6e3c8; --ink:#20322f; --muted:#536e67;
      --card:#ffffff; --accent:#2f8f6b; --radius:18px; --shadow:0 14px 40px rgba(32,50,47,.10);
    }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--ink);
      background:linear-gradient(180deg,var(--bg),#fff)}
    .wrap{max-width:940px;margin:0 auto;padding:32px 20px 64px}
    .hero{background:linear-gradient(120deg,var(--mint),var(--mint-strong));border-radius:var(--radius);
      padding:34px 28px;box-shadow:var(--shadow)}
    h1{margin:0 0 6px;font-size:40px}
    .lead{margin:8px 0 0;color:var(--ink);opacity:.9}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:22px;margin-top:22px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    label{display:block;font-weight:600;margin:10px 0 6px}
    input{width:100%;padding:12px 14px;border:1px solid #dfe7e4;border-radius:12px;font:inherit;outline:none}
    input:focus{border-color:#9fd9c2;box-shadow:0 0 0 4px rgba(159,217,194,.25)}
    .btn{display:inline-block;margin-top:14px;padding:12px 16px;font-weight:700;color:#fff;background:var(--accent);
      border:none;border-radius:999px;cursor:pointer}
    .btn-ghost{display:inline-block;margin-top:10px;padding:11px 14px;border-radius:999px;border:1px solid #cfe7dd;
      background:#ecf8f3;color:#1f5849;font-weight:700;cursor:pointer;width:100%;text-align:center}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .hint{color:var(--muted);font-size:14px;margin-top:10px}
    .right li{margin:6px 0}
    .state{margin-top:10px;padding:10px 12px;border-radius:12px;background:#f4fffa;border:1px solid #cfe7dd;font-size:14px;display:none}
    footer{margin-top:34px;color:var(--muted);font-size:14px;text-align:center}
    @media (max-width:840px){.grid{grid-template-columns:1fr}h1{font-size:34px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>StudyArt</h1>
      <p class="lead">Добро пожаловать! Войдите через Google/Apple или зарегистрируйтесь по email.</p>
    </div>

    <div class="grid">
      <!-- Левая колонка: аутентификация -->
      <div class="card">
        <h2 style="margin:0 0 12px">Регистрация / Вход</h2>

        <label for="email">Email</label>
        <input id="email" type="email" placeholder="you@example.com" required>
        <label for="password">Пароль</label>
        <input id="password" type="password" placeholder="минимум 6 символов" required>
        <div class="row">
          <button id="email-signup" class="btn">Зарегистрироваться</button>
          <button id="email-login" class="btn" style="background:#1d6d53">Войти</button>
        </div>

        <div class="hint">Или используйте аккаунт:</div>
        <div class="row">
          <button id="google-btn" class="btn-ghost">Продолжить с Google</button>
          <button id="apple-btn"  class="btn-ghost">Войти с Apple</button>
        </div>

        <div id="state" class="state"></div>
      </div>

      <!-- Правая колонка: зачем входить -->
      <div class="card right">
        <h2 style="margin:0 0 8px;">Зачем входить?</h2>
        <ul>
          <li>Сохранять свои наборы слов</li>
          <li>Синхронизировать прогресс между устройствами</li>
          <li>Получать ранний доступ к новым фишкам</li>
        </ul>
      </div>
    </div>

    <footer>© <span id="y"></span> StudyArt</footer>
  </div>

  <!-- Firebase (модульный SDK) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth, onAuthStateChanged, signOut,
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      GoogleAuthProvider, OAuthProvider, signInWithPopup
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // --- PROD конфиг studyart-6675d ---
    const firebaseConfig = {
      apiKey: "AIzaSyCmSTO4bu5nNA2SpPYNgjPvj2IvVxQSQqk",
      authDomain: "studyart-6675d.firebaseapp.com",
      projectId: "studyart-6675d",
      storageBucket: "studyart-6675d.appspot.com",
      messagingSenderId: "139893219770",
      appId: "1:139893219770:web:2780393b8ee66ebc323d83"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const $ = s => document.querySelector(s);
    const state = $("#state");
    const show = (t)=>{ state.textContent = t; state.style.display="block"; };

    // 0) Если уже вошёл — сразу в кабинет
    onAuthStateChanged(auth, (user) => {
      if (user) location.replace("/app/");
    });

    // 1) Email — регистрация
    $("#email-signup").addEventListener("click", async () => {
      const email = $("#email").value.trim();
      const pass  = $("#password").value.trim();
      try {
        await createUserWithEmailAndPassword(auth, email, pass);
        location.href = "/app/";
      } catch (e) { show("Ошибка регистрации: " + (e.message||e)); }
    });

    // 2) Email — вход
    $("#email-login").addEventListener("click", async () => {
      const email = $("#email").value.trim();
      const pass  = $("#password").value.trim();
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        location.href = "/app/";
      } catch (e) { show("Ошибка входа: " + (e.message||e)); }
    });

    // 3) Google — вход (popup)
    $("#google-btn").addEventListener("click", async () => {
      try {
        const provider = new GoogleAuthProvider();
        await signInWithPopup(auth, provider);
        location.href = "/app/";
      } catch (e) { show("Google: " + (e.message||e)); }
    });

    // 4) Apple — заработает после настройки в Apple Dev и включения в Firebase
    $("#apple-btn").addEventListener("click", async () => {
      try {
        const provider = new OAuthProvider('apple.com');
        await signInWithPopup(auth, provider);
        location.href = "/app/";
      } catch (e) { show("Apple: " + (e.message||e)); }
    });

    document.getElementById("y").textContent = new Date().getFullYear();
  </script>
</body>
</html>
